{% set KUBE_APISERVER_ADDR, KUBE_APISERVER_PORT = ansible_default_ipv4.address, 6443 %}
{% if inventory_hostname in groups['master'] %}
  {% if IP_STACK | default("ipv4") == "ipv6" %}
    {% set KUBE_APISERVER_ADDR, KUBE_APISERVER_PORT = ansible_default_ipv6.address, 6443 %}
  {% else %}
    {% set KUBE_APISERVER_ADDR, KUBE_APISERVER_PORT = ansible_default_ipv4.address, 6443 %}
  {% endif %}
{% else %}
  {% if ha.type == "none" %}
    {% if IP_STACK | default("ipv4") == "ipv6" %}
      {% set KUBE_APISERVER_ADDR, KUBE_APISERVER_PORT = {{ hostvars[groups['master'][0]]['ansible_facts']['default_ipv6']['address'] }}, 6443 %}
    {% else %}
      {% set KUBE_APISERVER_ADDR, KUBE_APISERVER_PORT = {{ hostvars[groups['master'][0]]['ansible_facts']['default_ipv4']['address'] }}, 6443 %}
    {% endif %}
  {% else %}
    {% if ha.type == "slb" %}
      {% set KUBE_APISERVER_ADDR, KUBE_APISERVER_PORT = ha.vip, 8443 %}
    {% else %}
      {% set KUBE_APISERVER_ADDR, KUBE_APISERVER_PORT = ha.vip, 6443 %}
    {% endif %}
  {% endif %}
{% endif %}

apiVersion: v1
clusters:
- cluster:
    certificate-authority: /etc/kubernetes/pki/ca.crt
{% if IP_STACK | default("ipv4") == "ipv6" %}
    server: https://[{{ KUBE_APISERVER_ADDR }}]:{{ KUBE_APISERVER_PORT }}
{% else %}
    server: https://{{ KUBE_APISERVER_ADDR }}:{{ KUBE_APISERVER_PORT }}
{% endif %}
  name: kubernetes
contexts:
- context:
    cluster: kubernetes
    user: system:kube-scheduler
  name: system:kube-scheduler@kubernetes
current-context: system:kube-scheduler@kubernetes
kind: Config
preferences: {}
users:
- name: system:kube-scheduler
  user:
    client-certificate: /etc/kubernetes/pki/kube-scheduler.crt
    client-key: /etc/kubernetes/pki/kube-scheduler.key
