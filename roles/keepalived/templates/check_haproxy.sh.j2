#!/bin/bash
VIRTUAL_IP={{ ha.vip }}

errorExit() {
    echo "*** $*" 1>&2
    exit 1
}

if ip addr | grep -q $VIRTUAL_IP ; then
  curl {{ ha.vip | ip | select('eq', 6, '-6', '') }} -s --max-time 2 --insecure https://{{ VIRTUAL_IP | ip_format }}:8443/healthz  -o /dev/null || errorExit "Error GET https://{{ VIRTUAL_IP | ip_format }}:8443/healthz"
fi
