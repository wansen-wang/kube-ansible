---
ansible_ssh_port: 22
ansible_ssh_user: 'root'
ansible_ssh_pass: 'root'

timezone: 'Asia/Shanghai'

modprobe:
  filename: /etc/modules
  params:
    - nf_conntrack
    - nf_conntrack_ipv4
    - br_netfilter
    - overlay

ipvs:
  filename: /etc/modules
  params:
    - ip_vs
    - ip_vs_lc
    - ip_vs_wlc
    - ip_vs_rr
    - ip_vs_wrr
    - ip_vs_lblc
    - ip_vs_lblcr
    - ip_vs_dh
    - ip_vs_sh
    - ip_vs_fo
    - ip_vs_nq
    - ip_vs_sed
    - ip_vs_ftp

sysctl:
  filename: /etc/sysctl.d/100-kubernetes.conf
  params:
    net.ipv4.tcp_keepalive_time: 600
    net.ipv4.tcp_keepalive_intvl: 30
    net.ipv4.tcp_keepalive_probes: 10
    net.ipv6.conf.all.disable_ipv6: 1
    net.ipv6.conf.default.disable_ipv6: 1
    net.ipv6.conf.lo.disable_ipv6: 1
    net.ipv4.neigh.default.gc_stale_time: 120
    net.ipv4.conf.all.rp_filter: 0
    net.ipv4.conf.default.rp_filter: 0
    net.ipv4.conf.default.arp_announce: 2
    net.ipv4.conf.lo.arp_announce: 2
    net.ipv4.conf.all.arp_announce: 2
    net.ipv4.ip_forward: 1
    net.ipv4.tcp_max_tw_buckets: 5000
    net.ipv4.tcp_syncookies: 1
    net.ipv4.tcp_max_syn_backlog: 1024
    net.ipv4.tcp_synack_retries: 2
    net.bridge.bridge-nf-call-ip6tables: 1
    net.bridge.bridge-nf-call-iptables: 1
    net.bridge.bridge-nf-call-arptables: 1
    net.netfilter.nf_conntrack_max: 2310720
    fs.inotify.max_user_watches: 89100
    # fs.may_detach_mounts: 1
    fs.file-max: 52706963
    fs.nr_open: 52706963
    vm.swappiness: 0
    vm.overcommit_memory: 1
    vm.panic_on_oom: 0

ca:
  days: 100000
  kubernetes:
    location: /etc/kubernetes/pki
  etcd:
    location: /etc/kubernetes/pki/etcd

kubernetes:
  # vip: 172.16.13.10/16

  # local、azure
  cloud: 
    type: local
    file: /etc/kubernetes/cloud.conf

    # cluster name
  name: 'kubernetes'

  settings:
    KubernetesClusterSVCIP: 10.96.0.1
    ClusterDns: 10.96.0.10
    PodCIDR: 10.244.0.0/16
    SvcCIDR: 10.96.0.0/12
    NodePortRange: 30000-32767
    ClusterDomain: cluster.local

  # etcd parameter configuration
  etcd: 
    enablepprof: true
    autocompactionretention: 1
    debug: true
    datadir: /var/lib/etcd
    initialclustertoken: 'kubernetes'
    initialclusterstate: 'new'
  
  # docker parameter configuration
  docker:
    datadir: /var/lib/docker
    daemon: 
      exec-opts:
        - "native.cgroupdriver=systemd"
      registry-mirrors:
        - "https://i3jtbyvy.mirror.aliyuncs.com"
      storage-driver: "overlay2"
      storage-opts: 
        - "overlay2.override_kernel_check=true"
      log-driver: "json-file"
      log-opts: 
        max-size: "500m"
        max-file: "2"
      insecure-registries:
        - 127.0.0.1
      debug: true

  # kubelet parameter configuration
  kubelet: 
    log:
      logLevel: 2
      logDir: /var/log/kubernetes
      logFile: kubelet.log
    pod_infra_container_image: gcr.azk8s.cn/google_containers/pause-amd64:3.1
    image_pull_progress_deadline: 2m

  # kube-apiserver parameter configuration
  apiserver: 
    bind: 0.0.0.0
    log:
      logLevel: 2
      logDir: /var/log/kubernetes
      logFile: kube-apiserver.log

  # kube-scheduler parameter configuration
  scheduler: 
    bind: 0.0.0.0
    log:
      logLevel: 2
      logDir: /var/log/kubernetes
      logFile: kube-scheduler.log

  # kube-controller-manager parameter configuration
  controllerManager:
    bind: 0.0.0.0
    PodCidr: 10.244.0.0/16
    SvcCidr: 10.96.0.0/12
    terminatedPodGcThreshold: 12500
    nodeStatusUpdate: Medium
    #nodeStatusUpdateFrequency: 10s
    #nodeMonitorPeriod: 5s     # 如果改它确保它小于下面的值
    #nodeMonitorGracePeriod: 40s
    #podEvictionTimeout: 5m
    log:
      logLevel: 2
      logDir: /var/log/kubernetes
      logFile: kube-controller-manager.log

  # kube-proxy parameter configuration
  proxy:
    log:
      logLevel: 2
      logDir: /var/log/kubernetes
      logFile: kube-proxy.log